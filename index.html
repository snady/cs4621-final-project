<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>CS 4621: FINAL</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/cs4620.css" rel="stylesheet">
    <link href="css/jquery-ui.min.css" rel="stylesheet">
    <link href="css/jquery-ui.theme.min.css" rel="stylesheet">
    <link href="css/jquery-ui.structure.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="container">

    <div align="center">
        <canvas id="webglCanvas" style="position: absolute;left: 0; top: 0;border: none; background-color: black; width: 100vw;height: 100vh;" ></canvas>
    </div>

    <br>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="scenes.js"></script>




<!-- Shaders -->


<!-- vertex shader -->
<script id="vertexShader" type="x-shader/x-vertex">
attribute vec3 vpos_vec;
attribute vec2 texture_coords;

varying vec2 tcoords;


void main() {
	tcoords = texture_coords;
	gl_Position = vec4(vpos_vec, 1.0);
}

</script>

<!-- fragment shader : mode uniform in charge of mode switching -->
<script id="fragmentBG" type="x-shader/x-fragment">

//Main
void main() {

   gl_FragColor = vec4(0.9, 0.9, 0.9, 1.0);
}

</script>


<script>
    //
    // TODO: Fill you code here and elsewhere in the HTML.
    //

    //from the exhibit code

    var canvas = $("#webglCanvas");
    
    function initWebGL(webglCanvas){
		var gl = webglCanvas[0].getContext("webgl");
    	if( !gl ){
    		throw new Error("Could not get WebGL context!");
    	}
    	return gl;
    }
    
    // var: gl and col 
    var gl = initWebGL(canvas);

    //Screen does not change when this is active
    //gl.viewport(0, 0, canvas.width, canvas.height);

    var col;

    function makeShader(gl, id, shaderType) {
	    let shade  = $("#" + id);
	    let src    = shade[0].text;
	    let shader = gl.createShader(shaderType);
	    gl.shaderSource(shader, src);
	    gl.compileShader(shader);
	    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
		let error = gl.getShaderInfoLog(shader);
		gl.deleteShader(shader);
		throw new Error(error);
	    }

	    return shader;
    }


    function makeProgram(vertShade, fragShade){
	    let program = gl.createProgram();
	    gl.attachShader(program, vertShade);
	    gl.attachShader(program, fragShade);

	    gl.linkProgram(program);
	    gl.validateProgram(program);
	    if(!gl.getProgramParameter(program, gl.LINK_STATUS)) {
		var info = "DARN!:" + gl.getProgramInfoLog(program);
		gl.deleteProgram(program);
		throw new Error(info)
	    }
	    return program;
    }

    function glslProgram(vertID, fragID){
	    let vertShader = makeShader(gl, vertID, gl.VERTEX_SHADER);
 	    let fragShader = makeShader(gl, fragID, gl.FRAGMENT_SHADER);
	    return makeProgram(vertShader, fragShader);
    }

    var program = glslProgram("vertexShader", "fragmentBG");

    // Quad Vertices
    var inds = [0, 1, 2, 0, 2, 3];
    var vertices = [
	-1.0, -1.0, 0.0, //LL 0
	-1, -1,     //   1
	1.0, -1.0, 0.0, //LR
	1, -1, 
	1.0, 1.0, 0.0, //TR
	1, 1,
	-1.0, 1.0, 0.0, //TL
	-1, 1 ];

    // Buffers
    var vArray = new Float32Array(vertices);
    var vertexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, vArray, gl.STATIC_DRAW);
    gl.bindBuffer(gl.ARRAY_BUFFER, null);
    
    var indexArray = new Uint16Array(inds);
    var indexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indexArray, gl.STATIC_DRAW);
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

    //Main loop -->
    function updateWebGL() {
    	//console.log("updating");

	gl.clearColor(0.0, 0.0, 0.0, 0.0); 
	gl.clear(gl.COLOR_BUFFER_BIT);

    
	gl.useProgram(program);

	gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
	var vPL = gl.getAttribLocation(program, "vpos_vec")
	gl.enableVertexAttribArray(vPL);
	gl.vertexAttribPointer(vPL, 3, gl.FLOAT, false, 4*5, 0);
	var vTL = gl.getAttribLocation(program, "texture_coords");
	gl.enableVertexAttribArray(vTL);
	gl.vertexAttribPointer(vTL, 2, gl.FLOAT, false, 4* 5, 4 * 3);
	gl.bindBuffer(gl.ARRAY_BUFFER, null);

	gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
	gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
	gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

	gl.useProgram(null);


    	window.requestAnimationFrame(updateWebGL);
    }

    window.requestAnimationFrame(updateWebGL);
</script>

</body>
</html>
